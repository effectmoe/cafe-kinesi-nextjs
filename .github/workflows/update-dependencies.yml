name: Update Dependencies

on:
  schedule:
    - cron: '0 0 * * 1' # æ¯é€±æœˆæ›œæ—¥ã®åˆå‰0æ™‚
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Update dependencies
        run: |
          echo "ğŸ“¦ Updating dependencies..."
          npm update --save

          echo "ğŸ”’ Running security audit..."
          npm audit fix --force || true

          echo "ğŸ“ Checking for major updates..."
          npx npm-check-updates -u

      - name: Install updated dependencies
        run: |
          npm ci --prefer-offline --no-audit

      - name: Run tests
        run: |
          npm run type-check || true
          npm run lint || true
          npm run build || true

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: update dependencies'
          title: 'ğŸ”„ ä¾å­˜é–¢ä¿‚ã®è‡ªå‹•æ›´æ–°'
          body: |
            ## ä¾å­˜é–¢ä¿‚ã®æ›´æ–°

            ã“ã®PRã¯å®šæœŸçš„ãªä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚

            ### å®Ÿè¡Œã•ã‚ŒãŸæ“ä½œ
            - âœ… npm updateã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
            - ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®è‡ªå‹•ä¿®æ­£
            - ğŸ“¦ ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ç¢ºèª

            ### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
            - [ ] ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã“ã¨
            - [ ] å‹ãƒã‚§ãƒƒã‚¯ãŒé€šã‚‹ã“ã¨
            - [ ] ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨
            - [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèªæ¸ˆã¿

            ### æ³¨æ„äº‹é …
            é‡å¤§ãªå¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            ãƒãƒ¼ã‚¸å‰ã«å¿…ãšå‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
          branch: update-dependencies
          delete-branch: true
          labels: |
            dependencies
            automated
          assignees: effectmoe
          reviewers: effectmoe