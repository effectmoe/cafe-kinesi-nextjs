import{t as w,v as P,r as s,bT as S,R as _,cr as E,ad as x,cs as M,ct as R,cc as k,am as U,cu as $,b9 as h,cq as j,cv as y,cn as D,a1 as F}from"./sanity-BBV8KDaf.js";function I(u){return w(function(t,a){var i=!1,n=0;t.subscribe(P(a,function(r){return(i||(i=!u(r,n++)))&&a.next(r)}))})}const O=u=>{const{comlink:t,refs:a,perspective:i}=u,n=S(),r=_(),p=s.useMemo(()=>new E,[]),d=s.useMemo(()=>p.asObservable().pipe(x(b=>R(b.map(e=>{const m={...e,_id:k(e._id)},f=i==="published"?U:n.observeForPreview(m,r.get(m._type)).pipe($(),I(o=>o.snapshot===null)),v={...e,_id:h(e._id)},g=n.observeForPreview(v,r.get(v._type));return j(g.pipe(y(f)),f).pipe(D(o=>!!o.snapshot),F(o=>{const c=o.snapshot;return{_id:h(c._id),title:c.title,subtitle:c.subtitle,description:c.description,imageUrl:c.imageUrl}}))}))),M(0)),[n,p,r,i]),l=s.useRef([]);return s.useEffect(()=>{const b=d.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),l.current=e});return()=>{b.unsubscribe()}},[t,d]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:l.current})),[t]),s.useEffect(()=>{p.next(a)},[a,p]),null};var q=s.memo(O);export{q as default};
